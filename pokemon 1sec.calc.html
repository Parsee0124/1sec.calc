<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ポケモンダメージ計算(簡易版)</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; }
    #result { height: 25vh; padding: 10px; background: #f0f0f0; }
    #inputs { margin: 10px; }
    .field {
      display: inline-block;
      width: 80px;
      margin: 5px;
      padding: 5px;
      border: 1px solid #999;
      background: #fff;
      text-align: right;
      font-size: 1.2em;
      min-height: 1.5em;
    }
    #keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; height: 75vh; }
    button { font-size: 1.5em; padding: 15px; }
    #options { grid-column: span 3; display: flex; justify-content: space-around; }
    #bar { height: 30px; background: #ccc; margin: 10px; position: relative; }
    #damage-range { height: 100%; background: red; }
  </style>
</head>
<body>
  <div id="result">
    <h2>ダメージ計算</h2>
    <div id="damage-output">最小: - / 最大: -</div>
    <div id="bar"><div id="damage-range" style="width:0%"></div></div>
  </div>

  <div id="inputs">
    攻撃: <div id="attack" class="field"></div>
    防御: <div id="defense" class="field"></div><br>
    HP: <div id="hp" class="field"></div>
    威力: <div id="power" class="field"></div>
  </div>

  <div id="keypad">
    <button onclick="appendNumber(1)">1</button>
    <button onclick="appendNumber(2)">2</button>
    <button onclick="appendNumber(3)">3</button>

    <button onclick="appendNumber(4)">4</button>
    <button onclick="appendNumber(5)">5</button>
    <button onclick="appendNumber(6)">6</button>

    <button onclick="appendNumber(7)">7</button>
    <button onclick="appendNumber(8)">8</button>
    <button onclick="appendNumber(9)">9</button>

    <button onclick="nextField()">次へ</button>
    <button onclick="appendNumber(0)">0</button>
    <button onclick="calculate()">計算</button>

    <div id="options">
      <label><input type="checkbox" id="stab">STAB</label>
      <label><input type="checkbox" id="band">ハチマキ</label>
      <label><input type="checkbox" id="orb">珠</label>
    </div>
  </div>

  <script>
    let currentField = "attack"; // 今どの欄を編集中か

    function appendNumber(num) {
      const field = document.getElementById(currentField);
      field.textContent = (field.textContent || "") + num;
    }

    function nextField() {
      if (currentField === "attack") currentField = "defense";
      else if (currentField === "defense") currentField = "hp";
      else if (currentField === "hp") currentField = "power";
      else currentField = "attack";
    }

    function getFieldValue(id) {
      return parseInt(document.getElementById(id).textContent) || 0;
    }

    // 五捨五超入 (0.5は切り捨て)
    function roundHalfDown(num) {
      const floor = Math.floor(num);
      if (num - floor > 0.5) return floor + 1;
      return floor;
    }

    function calculate() {
      const atk = getFieldValue("attack");
      const def = getFieldValue("defense");