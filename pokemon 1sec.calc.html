<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ポケモンダメージ計算(簡易版)</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; }
    #result { height: 25vh; padding: 10px; background: #f0f0f0; }
    #inputs { margin: 10px; }
    input { width: 80px; margin: 5px; text-align: right; font-size: 1.2em; }
    #keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; height: 75vh; }
    button { font-size: 1.5em; padding: 15px; }
    #options { grid-column: span 3; display: flex; justify-content: space-around; }
    #bar { height: 30px; background: #ccc; margin: 10px; position: relative; }
    #damage-range { height: 100%; background: red; }
  </style>
</head>
<body>
  <div id="result">
    <h2>ダメージ計算</h2>
    <div id="damage-output">最小: - / 最大: -</div>
    <div id="bar"><div id="damage-range" style="width:0%"></div></div>
  </div>

  <div id="inputs">
    攻撃: <input id="attack" type="number" readonly>
    防御: <input id="defense" type="number" readonly><br>
    HP: <input id="hp" type="number" readonly>
    威力: <input id="power" type="number" readonly>
  </div>

  <div id="keypad">
    <button onclick="appendNumber(1)">1</button>
    <button onclick="appendNumber(2)">2</button>
    <button onclick="appendNumber(3)">3</button>

    <button onclick="appendNumber(4)">4</button>
    <button onclick="appendNumber(5)">5</button>
    <button onclick="appendNumber(6)">6</button>

    <button onclick="appendNumber(7)">7</button>
    <button onclick="appendNumber(8)">8</button>
    <button onclick="appendNumber(9)">9</button>

    <button onclick="nextField()">次へ</button>
    <button onclick="appendNumber(0)">0</button>
    <button onclick="calculate()">計算</button>

    <div id="options">
      <label><input type="checkbox" id="stab">STAB</label>
      <label><input type="checkbox" id="band">ハチマキ</label>
      <label><input type="checkbox" id="orb">珠</label>
    </div>
  </div>

  <script>
    let currentField = "attack"; // 今選択している入力欄

    function appendNumber(num) {
      const field = document.getElementById(currentField);
      field.value = (field.value || "") + num;
    }

    function nextField() {
      if (currentField === "attack") currentField = "defense";
      else if (currentField === "defense") currentField = "hp";
      else if (currentField === "hp") currentField = "power";
      else currentField = "attack";
    }

    function roundHalfDown(num) {
      const floor = Math.floor(num);
      if (num - floor > 0.5) return floor + 1;
      return floor;
    }

    function calculate() {
      const atk = parseInt(document.getElementById("attack").value) || 0;
      const def = parseInt(document.getElementById("defense").value) || 0;
      const hp = parseInt(document.getElementById("hp").value) || 1;
      const power = parseInt(document.getElementById("power").value) || 0;

      let base = Math.floor(Math.floor((Math.floor((2 * 50) / 5 + 2) * power * atk / def) / 50) + 2);

      const stab = document.getElementById("stab").checked ? 1.5 : 1.0;
      const band = document.getElementById("band").checked ? 1.5 : 1.0;
      const orb = document.getElementById("orb").checked ? 1.3 : 1.0;

      let damages = [];
      for (let r = 85; r <= 100; r++) {
        let dmg = base;
        dmg = roundHalfDown(dmg * r / 100);
        dmg = roundHalfDown(dmg * stab);
        dmg = roundHalfDown(dmg * band);
        dmg = roundHalfDown(dmg * orb);
        damages.push(dmg);
      }

      const min = Math.min(...damages);
      const max = Math.max(...damages);

      document.getElementById("damage-output").textContent =
        `最小: ${min} (${Math.floor(min/hp*100)}%) / 最大: ${max} (${Math.floor(max/hp*100)}%)`;

      document.getElementById("damage-range").style.width = `${Math.floor(max/hp*100)}%`;
    }
  </script>
</body>
</html>